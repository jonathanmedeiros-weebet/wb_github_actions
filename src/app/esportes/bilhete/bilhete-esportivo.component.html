<section class="pre-bilhete"
         [ngClass]="{'pre-bilhete-mobile': displayPreTicker, 'hide': !isEsporte, 'hide-desktop': isPagina}">
    <div #scrollframe class="bilhete-container">
        <ng-container *ngIf="liveTrackerUrl || liveStreamUrl">
            <div class="campinho">
                <div class="campinho-toogle">
                    <div class="options">
                        <a *ngIf="liveTrackerUrl" [class]="{'active': showCampinho}" (click)="showCampinhoFrame()">
                            <svg width="800px" height="800px" viewBox="0 -199.5 1423 1423" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M105.124 107.703h1142.109v796.875h-1142.109v-796.875z" fill="transparent"></path><path d="M1069.108 336.219h157.266v353.672h-157.266zM128.562 336.219h157.266v353.672h-157.266z" fill="transparent"></path><path d="M1120.438 90.125h-887.813c-78.646 0.133-142.367 63.853-142.5 142.488v558.528c0.133 78.647 63.853 142.367 142.488 142.5h887.826c78.646-0.133 142.367-63.853 142.5-142.488v-558.293c0 0 0 0 0 0 0-78.747-63.771-142.601-142.488-142.733zM651.688 626.844c-53.93-11.239-93.867-58.377-93.867-114.844s39.938-103.605 93.106-114.711l0.761 229.554zM698.563 397.156c53.93 11.239 93.867 58.377 93.867 114.844s-39.938 103.605-93.106 114.711l-0.761-229.554zM136.062 347.937h101.25c0 0 0 0 0 0 23.429 0 42.421 18.992 42.421 42.421v243.516c0 0 0 0 0 0 0 23.429-18.992 42.421-42.421 42.421 0 0 0 0 0 0h-101.25v-328.125zM136.062 791.375v-68.438h101.25c49.317 0 89.297-39.98 89.297-89.297v-242.578c0-49.317-39.98-89.297-89.297-89.297 0 0 0 0 0 0h-101.25v-68.438c0.133-52.759 42.867-95.492 95.613-95.625h420.011v212.813c-79.347 12.438-139.329 80.308-139.329 162.188 0 81.879 59.982 149.75 138.403 162.068l0.927 212.932h-419.063c-0.209 0.002-0.457 0.003-0.705 0.003-52.942 0-95.859-42.918-95.859-95.859 0-0.165 0.001-0.331 0.002-0.497zM1120.438 887h-421.875v-212.813c79.347-12.438 139.329-80.308 139.329-162.188 0-81.879-59.982-149.75-138.403-162.068l-0.927-212.932h421.875c52.759 0.133 95.492 42.866 95.625 95.613v68.45h-95.625c0 0 0 0 0 0-49.317 0-89.297 39.98-89.297 89.297v243.516c0 49.317 39.979 89.297 89.297 89.297 0 0 0 0 0 0h93.75v68.438c-0.249 52.012-41.883 94.217-93.648 95.39zM1216.063 347.937v328.125h-95.625c0 0 0 0 0 0-23.429 0-42.421-18.992-42.421-42.421 0 0 0 0 0 0v-242.578c0 0 0 0 0 0 0-23.429 18.992-42.421 42.421-42.421 0 0 0 0 0 0h93.75z"></path></svg>
                        </a>
                        <a *ngIf="liveStreamUrl" [class]="{'active': showStream}" (click)="showStreamFrame()">
                            <svg width="800px" height="800px" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="none"><path fill="transparent" stroke-linejoin="round" stroke-width="10" d="M22 126V42a4 4 0 0 1 4-4h140a4 4 0 0 1 4 4v84a4 4 0 0 1-4 4H26a4 4 0 0 1-4-4Z"></path><path fill="transparent" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" d="M52 154h88"></path><path fill="transparent" stroke-linejoin="round" stroke-width="10" d="M118 84 82 62v44l36-22Z"></path></svg>
                        </a>
                    </div>
                    <i [class]="showFrame ? 'fa fa-angle-up' : 'fa fa-angle-down'" (click)="toggleFrame()"></i>
                </div>
                <div class="iframe-responsive" *ngIf="showFrame && showCampinho">
                    <iframe [src]="liveTrackerUrl" scrolling="no" frameborder="0" width="320" height="200"></iframe>
                </div>
                <ng-container *ngIf="showFrame && showStream">
                    <div class="iframe-responsive stream" *ngIf="isLoggedIn">
                        <iframe [src]="liveStreamUrl" scrolling="no" frameborder="0" width="320" height="200"></iframe>
                    </div>
                    <div class="no-login" *ngIf="!isLoggedIn">
                        <p>Precisa entrar para poder assistir.</p>
                        <a class="btn btn-custom" (click)="abrirLogin()">Entrar</a>
                    </div>
                </ng-container>
            </div>
        </ng-container>
        <div class="blihete">
            <div class="titulo-bilhete">
                <a (click)="closeCupom()" class="botao-esquerdo" *ngIf="mobileScreen">
                    <i class="fa fa-arrow-left"></i>
                </a>
                <div class="titulo">{{'bilhete.titulo' | translate}}</div>
                <div class="botao-direito" *ngIf="mobileScreen"></div>
            </div>
            <div class="acoes-bilhete">
                {{'bilhete.jogosSelecionados' | translate}}
                <a [ngClass]="{'disabled': itens.length == 0}" (click)="removerItens()">
                    <i class="fa-solid fa-trash"></i> {{'bilhete.removerTodos' | translate}}
                </a>
            </div>
            <div class="pre-bilhete-esportes">
                <div *ngIf="itens.length > 0; else semJogosSelecionados" class="div-jogos-selecionados">
                    <div *ngFor="let item of itens.value; let i=index" class="jogo-selecionado">
                        <div class="jogo-selecionado-inner">
                            <div class="horario">
                                {{item.jogo.horario | moment: 'DD.MM.YYYY HH:mm'}} <span
                                *ngIf="item.jogo.ao_vivo"> - {{'bilhete.aoVivo' | translate}}</span>
                            </div>
                            <!-- <div class="campeonato-nome">
                                {{item.jogo.campeonato.nome}}
                            </div> -->
                            <div class="odd-bilhete" [ngClass]="{'mudou': item.mudanca}">
                            <span *ngIf="item.cotacao.nome; else chave">
                                {{item.cotacao.nome}}
                            </span>
                                <ng-template #chave>
                                <span *ngIf="item.jogo.sport_id == 1">
                                    {{item.cotacao.chave | tipoAposta}}
                                </span>
                                    <span *ngIf="item.jogo.sport_id != 1;">
                                    {{item.cotacao.chave | tipoApostaCustom: item.jogo.time_a_nome :item.jogo.time_b_nome}}
                                </span>
                                </ng-template>
                                <span class="valor">
                                ({{item.cotacao.valor | calcularCotacao: item.cotacao.chave:
                                    item.jogo.event_id: item.jogo.favorito : item.jogo.ao_vivo }})
                                <del *ngIf="item.cotacao_antiga_valor" class="cotaca-antiga-valor">
                                    ({{item.cotacao_antiga_valor | calcularCotacao: item.cotacao.chave:
                                    item.jogo.event_id: item.jogo.favorito : item.jogo.ao_vivo}})
                                </del>
                            </span>
                            </div>
                            <div class="mercado">
                                {{item.cotacao.chave | oddCategoria}}
                            </div>
                            <div class="jogo-nome">
                                {{item.jogo.nome}}
                            </div>
                        </div>
                        <div class="remover-item" (click)="removerItem(i)">
                            <i class="fa fa-times"></i>
                        </div>
                    </div>
                </div>
                <ng-template #semJogosSelecionados>
                    <div class="div-jogos-selecionados">
                        <div id="nenhum-jogo">
                            <p>
                                <span><i
                                    class="fa-solid fa-circle-info"></i> {{'bilhete.nenhumaApostaSelecionada' | translate}}!</span>
                            </p>
                            {{'bilhete.selecioneAlgumaAposta' | translate}}
                        </div>
                    </div>
                </ng-template>
            </div>
            <div class="footer-bilhete">
                <form [formGroup]="form" (ngSubmit)="onSubmit()">
                    <div class="div-inputs">
                        <div class="form-group" *ngIf="!isCliente && modoCambista">
                            <div class="input-md">
                                <input type="text" id="nomeApostador" formControlName="apostador"
                                    [ngClass]="applyCssInputError('apostador')"
                                    class="form-control inverted-out" placeholder=" ">
                                <label for="nomeApostador">{{'bilhete.nomeDoApostador' | translate}}</label>

                            </div>
                            <app-error-msg [control]="form.get('apostador')" label="{{'geral.apostador' | translate}} "></app-error-msg>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <i>R$</i>
                                <input type="number" formControlName="valor" [min]="apostaMinima"
                                    [max]="apostaMaximo" (focusin)="setFocoValor(true)" (focusout)="setFocoValor(false)"
                                    [ngClass]="applyCssInputError('valor')" class="form-control inverted-out"
                                    placeholder="Valor">
                            </div>
                            <app-error-msg [control]="form.get('valor')" label="Valor"></app-error-msg>
                        </div>
                        <div class="valores" [ngClass]="{'fadeIn': valorFocado, 'fadeOut': !valorFocado}">
                            <button type="button" (click)="definirValor(5)" class="btn btn-sm">{{5 | currency}}</button>
                            <button type="button" (click)="definirValor(10)" class="btn btn-sm">{{10 | currency}}</button>
                            <button type="button" (click)="definirValor(20)" class="btn btn-sm">{{20 | currency}}</button>
                            <button type="button" (click)="definirValor(50)" class="btn btn-sm">{{50 | currency}}</button>
                        </div>
                        <div class="informations">
                            {{'bilhete.cotacao' | translate}}:
                            <span class="cotacao">{{cotacao | cotacao}}</span>
                            <br>
                            {{'bilhete.possiveisGanhos' | translate}}:
                            <span class="possivel-ganho">{{possibilidadeGanho | currency}}</span>
                        </div>
                        <div *ngIf="isLoggedIn" class="form-group form-check-custom form-check-style-1 alteracoes-odds">
                            <input type="checkbox" class=""
                                id="aceito-alteracoes-odds"
                                formControlName="aceitar_alteracoes_odds">
                            <label for="aceito-alteracoes-odds" class="pointer">
                                {{'bilhete.aceitarAlteracoesDeOdds' | translate}}
                            </label>
                        </div>
                        <div *ngIf="posicaoFinanceira.bonus != 0 && posicaoFinanceira.bonusModalidade === 'esportivo' && isCliente && isLoggedIn"
                            class="form-group form-check-custom form-check-style-1 utilizar-bonus">
                            <input type="checkbox" class=""
                                id="utilizar-bonus"
                                formControlName="utilizar_bonus" (click)="toggleUtilizarBonus()">
                            <label for="utilizar-bonus">
                                {{'bilhete.utilizarBonus' | translate}}
                            </label>
                        </div>
                    </div>
                    <div class="form-group submit-buttons">
                        <ng-container *ngIf="mudancas;else btnApostar">
                            <div class="mensagem-mudanca">
                                {{'bilhete.algumasCotacoesMudaram' | translate}}
                            </div>
                            <button type="button" (click)="aceitarMudancas()" id="aceitar-mudancas"
                                    class="btn btn-custom btn-block">
                                {{'bilhete.aceitarAlteracoes' | translate}}
                            </button>
                        </ng-container>
                        <ng-template #btnApostar>
                            <button *ngIf="!disabled; else btnProcessando" [attr.disabled]="itens.length <= 0 ? true : none"
                                    class="btn btn-custom btn-block">
                                {{'bilhete.apostar' | translate}} <b>({{itens.length}})</b>
                            </button>
                            <ng-template #btnProcessando>
                                <button disabled class="btn btn-custom btn-block">
                                    {{'geral.processando' | translate}}... <span *ngIf="apostaAoVivo">({{delay}}) </span>
                                    <i class="fa fa-spinner fa-spin"></i>
                                </button>
                            </ng-template>
                        </ng-template>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<ng-template #apostaDeslogadoModal let-modal>
    <div class="modal-body" id="aposta-deslogado">
        <div class="titulo-bilhete hide-desktop">
            <a (click)="closeCupomPre()" class="fechar-pre-bilhete">
                <i class="fa fa-arrow-left"></i>
            </a>
            <div class="titulo">{{'bilhete.titulo' | translate}}</div>
            <a [routerLink]="['/esportes/futebol/jogos']" (click)="closeCupomPre()" class="fechar-pre-bilhete">
                <i class="fa fa-home"></i>
            </a>
        </div>

        <div *ngIf="opcoes.cartao_aposta" class="tabs">
            <a class="tab" (click)="trocarTipoApostaDeslogado('preaposta')"
               [ngClass]="{'active':tipoApostaDeslogado == 'preaposta'}">
                {{'bilhete.preAposta' | translate}}
            </a>
            <a class="tab" (click)="trocarTipoApostaDeslogado('cartao')"
               [ngClass]="{'active':tipoApostaDeslogado == 'cartao'}">
                {{'bilhete.cartaoDeAposta' | translate}}
            </a>
        </div>
        <h4>{{'bilhete.jogosSelecionados' | translate}}</h4>
        <div class="lista-apostas" *ngIf="itens.length > 0">
            <div *ngFor="let item of itens.value; let i=index" class="aposta-item">
                <div class="">
                    <div class="horario">
                        {{item.jogo.horario | moment: 'DD.MM.YYYY HH:mm'}}
                    </div>
                    <div class="cotacao">
                        <span *ngIf="item.cotacao.nome; else chave">
                            {{item.cotacao.nome}}
                        </span>
                        <ng-template #chave>
                            <span *ngIf="item.jogo.sport_id == 1; else nomeOddCustom">
                                {{item.cotacao.chave | tipoAposta}}
                            </span>
                            <ng-template #nomeOddCustom>
                                {{item.cotacao.chave | tipoApostaCustom: item.jogo.time_a_nome :
                                item.jogo.time_b_nome}}
                            </ng-template>
                        </ng-template>
                        <span class="valor">
                            {{item.cotacao.valor | calcularCotacao: item.cotacao.chave:
                            item.jogo.event_id: item.jogo.favorito : item.jogo.ao_vivo }}
                        </span>
                        <span>
                            {{item.cotacao.chave | oddCategoria}}
                        </span>
                    </div>
                    <div class="jogo-nome">
                        {{item.jogo.nome}}
                    </div>
                </div>
                <div class="remover" (click)="removerItem(i)">
                    <i class="fa fa-times"></i>
                </div>
            </div>
        </div>
        <div class="cartao-form" *ngIf="tipoApostaDeslogado == 'cartao'">
            <form style="font-size: 1rem;" [formGroup]="cartaoApostaForm">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label>{{'bilhete.chave' | translate}}</label>
                        <input type="text" class="form-control inverted-out" formControlName="chave" autocomplete="off"
                               style="text-transform:uppercase;" mask="AAA-AAA-AAA" [dropSpecialCharacters]="false">
                    </div>
                    <div class="form-group col-md-6">
                        <label>{{'bilhete.pin' | translate}}</label>
                        <input type="password" class="form-control inverted-out" formControlName="pin"
                               autocomplete="off">
                    </div>
                </div>
                <div class="check-group">
                    <input type="checkbox" id="manter-cartao" formControlName="manter_cartao">
                    <label for="manter-cartao">{{'bilhete.manterCartao' | translate}}</label>
                </div>
            </form>
        </div>
        <div class="buttons mt-4">
            <button type="button" class="btn btn-custom2" (click)="modalRef.dismiss('Cross click')">
                {{'modais.fechar' | translate}}
            </button>
            <button type="button" class="btn btn-custom " *ngIf="!disabled; else processandoPreAposta"
                    (click)="finalizarApostaDeslogado()">
                {{'modais.finalizar' | translate}} <span>{{ btnText || ('bilhete.preAposta' | translate) }}</span> 
            </button>
            <ng-template #processandoPreAposta>
                <button disabled class="btn btn-custom">
                    {{'geral.processando' | translate}}... <i class="fa fa-spinner fa-spin"></i>
                </button>
            </ng-template>
        </div>
    </div>
</ng-template>
