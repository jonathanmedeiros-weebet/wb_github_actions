<section class="pre-bilhete" [ngClass]="{'pre-bilhete-mobile': displayPreTicker}">
    <div class="pre-bilhete-desafio">
        <h4>BILHETE</h4>
        <a (click)="closeCupom()" class="fechar-pre-bilhete">
            <i class="fa fa-times fa-lg"></i>
        </a>
        <div class="value-informations">
            <p>
                Valor da aposta:
                <span class="valor">{{form.value.valor | currency}}</span>
            </p>
            <p>
                Possível Ganho:
                <span class="possivel-ganho">{{possibilidadeGanho | currency}}</span>
            </p>
            <p class="valores">
                <button type="button" (click)="definirValor(5)" class="btn btn-sm">{{5 | currency}}</button>
                <button type="button" (click)="definirValor(10)" class="btn btn-sm">{{10 | currency}}</button>
                <button type="button" (click)="definirValor(20)" class="btn btn-sm">{{20 | currency}}</button>
                <button type="button" (click)="definirValor(50)" class="btn btn-sm">{{50 | currency}}</button>
            </p>
        </div>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="div-inputs">
                <div class="form-group" *ngIf="!isCliente">
                    <input type="text" formControlName="apostador" [ngClass]="applyCssInputError('apostador')"
                        class="form-control" placeholder="Nome do apostador...">
                    <app-error-msg [control]="form.get('apostador')" label="Apostador"></app-error-msg>
                </div>
                <div class="form-group">
                    <input type="number" formControlName="valor" [min]="apostaMinima"
                        [ngClass]="applyCssInputError('valor')" class="form-control" placeholder="Valor">
                    <app-error-msg [control]="form.get('valor')" label="Valor"></app-error-msg>
                </div>
            </div>
            <div class="form-group">
                <button *ngIf="!disabled; else btnProcessando" class="btn btn-custom btn-block">
                    Apostar <b>({{itens.length}})</b>
                </button>
                <ng-template #btnProcessando>
                    <button disabled class="btn btn-custom btn-block">
                        Processando... <span *ngIf="apostaAoVivo">({{delay}}) </span>
                        <i class="fa fa-spinner fa-spin"></i>
                    </button>
                </ng-template>
            </div>
        </form>

        <div *ngIf="itens.length > 0" class="div-desafios-selecionados">
            <h3>
                Eventos Selecionados
            </h3>
            <div *ngFor="let item of itens.value; let i=index" class="desafio-selecionado">
                <div class="desafio-selecionado-inner">
                    <div class="categoria-nome">
                        {{item.desafio.categoria.nome}}
                    </div>
                    <div class="desafio-nome">
                        {{item.desafio.nome}}
                    </div>
                    <div class="odd">
                        Resposta: <span class="odd-nome">{{item.odd.nome}} </span><span
                            class="odd-valor">({{item.odd.cotacao}})</span>
                    </div>
                </div>
                <div class="remover-item" (click)="removerItem(i)">
                    <i class="fa fa-times"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="fixed-bar-bilhete" (click)="openCupom()" [ngStyle]="{'display': displayPreTicker? 'none' : ''}">
    <div>
        <label>Valor</label>
        <span>{{form.value.valor | currency}}</span>
    </div>
    <div>
        <label>desafio(s)</label>
        <span>{{form.value.itens.length}}</span>
    </div>
    <div>
        <label>P. de Prêmio</label>
        <span>{{possibilidadeGanho | currency}}</span>
    </div>
    <div class="open-bilhete">
        <a>
            <i class="fa fa-lg fa-chevron-circle-up"></i>
        </a>
    </div>
</div>

<ng-template #apostaDeslogadoModal let-modal>
    <div class="modal-body" id="aposta-deslogado">
        <div *ngIf="opcoes.cartao_aposta" style="background: #e2e2e2; border-bottom: 1px solid;" class="tabs">
            <button class="btn" (click)="trocarTipoApostaDeslogado('preaposta')"
                [ngClass]="{'active':tipoApostaDeslogado == 'preaposta'}">
                Pré-Aposta
            </button>
            <button class="btn" (click)="trocarTipoApostaDeslogado('cartao')"
                [ngClass]="{'active':tipoApostaDeslogado == 'cartao'}">
                Cartão de Aposta
            </button>
        </div>
        <div *ngIf="itens.length > 0">
            <div *ngFor="let item of itens.value; let i=index" class="aposta-item">
                <div class="">
                    <div class="desafio-nome">
                        {{item.desafio.nome}}
                    </div>
                    <div class="campeonato-nome">
                        {{item.desafio.categoria.nome}}
                    </div>
                    <div class="cotacao">
                        Resposta: <span>{{item.odd.nome}}</span>
                        <span class="valor">
                            {{item.odd.cotacao}}
                        </span>
                    </div>
                </div>
                <div class="remover" (click)="removerItem(i)">
                    <i class="fa fa-times"></i>
                </div>
            </div>
        </div>
        <div class="cartao-form" *ngIf="tipoApostaDeslogado == 'cartao'">
            <form style="font-size: 1rem;" [formGroup]="cartaoApostaForm">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label>Chave</label>
                        <input type="text" class="form-control" formControlName="chave" autocomplete="off"
                            style="text-transform:uppercase;" mask="AAA-AAA-AAA" [dropSpecialCharacters]="false">
                    </div>
                    <div class="form-group col-md-6">
                        <label>PIN</label>
                        <input type="password" class="form-control" formControlName="pin" autocomplete="off">
                    </div>
                </div>
                <div class="form-check col-md-6">
                    <input type="checkbox" class="form-check-input" id="manter-cartao" formControlName="manter_cartao">
                    <label class="form-check-label" for="manter-cartao">Manter Cartão</label>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" style="background: #e2e2e2;" class="btn" (click)="modalRef.dismiss()">Fechar</button>
        <button type="button" class="btn btn-custom" *ngIf="!disabled; else processandoPreAposta"
            (click)="finalizarApostaDeslogado()">
            Finalizar {{btnText}}
        </button>
        <ng-template #processandoPreAposta>
            <button disabled class="btn btn-custom">
                Processando... <i class="fa fa-spinner fa-spin"></i>
            </button>
        </ng-template>
    </div>
</ng-template>
